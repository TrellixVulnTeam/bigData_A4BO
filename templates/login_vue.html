{% extends 'base.html' %}

{% block title %}登录-vue{% endblock %}

{% block navbar %}

{% endblock navbar %}

{% block body %}

    <div style="width: 50%;margin: 200px auto;" id="app">

        <input type="text" name="user_name"/>
        <input type="text" name="password"/>
        <p v-text="masg"></p>
        <button style="width: 100%" type="submit" class="btn btn-default" @click="login">登录</button>

        <table class="table table-bordered">
            <tr>
                <td>年级</td>
                <td>学科</td>
                <td>课件数量</td>
            </tr>
            <tr v-for=" i  in res">
                <td v-text="i.grade_name"></td>
                <td v-text="i.subject_name"></td>
                <td v-text="i.word_count"></td>
            </tr>
        </table>
        <div id="main" style="width: 600px;height:400px;"></div>
    </div>


{% endblock %}

{% block js %}

    <script type="text/javascript">

        var app = new Vue({
            el: '#app',
            delimiters: ['[[', ']]'],
            data: {
                masg: '12',
                res: '',

            },
            methods: {
                login: function () {
                    axios.post('/login_vue_json', {'name': 'mike', 'age': '18'})
                        .then(data_res => {
                            console.log(data_res)

                        })
                        .catch(err => (console.log(err)))

                },
                get_login: function () {
                    axios.get('/login_vue_json')
                        .then(data_list => {
                            {#console.log(data_list.data)#}
                            this.res = data_list.data.grade_data
                            this.bar_name = data_list.data.bar_data.bar_name
                            this.xdata = data_list.data.bar_data.x_data
                            this.ydata = data_list.data.bar_data.y_data
                            this.$options.methods.myEcharts(this.bar_name,this.xdata,this.ydata)

                        })
                        .catch(err => (console.log(err)))
                },
                myEcharts(bar_name,xdata,ydata) {
                    // 基于准备好的dom，初始化echarts实例
                    var myChart = echarts.init(document.getElementById('main'));
                    // 指定图表的配置项和数据
                    var option = {
                        title: {
                            text: bar_name
                        },
                        tooltip: {},
                        legend: {
                            data: ['销量']
                        },
                        xAxis: {
                            data: xdata
                        },
                        yAxis: {},
                        series: [{
                            name: '销量',
                            type: 'bar',
                            data:ydata
                        }]
                    };

                    // 使用刚指定的配置项和数据显示图表。
                    myChart.setOption(option);
                },


            },
            mounted() {
                this.get_login();


            }

        });

    </script>


{% endblock %}